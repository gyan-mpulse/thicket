/* 
*
* Thicket -- made by Gyan (gyan.biz). 
*
* This is a default script dependent on jQuery that runs the vanilla
* functionality of Thicket, including popups, alerts, and AJAX calls.
* To customize the script, open /includes/js/script.orig.js, make 
* your changes, and then paste it into here. 
* 
*/

function padlock(e,t){logged_in||$(e).html("<p class='padlocked'>"+t+"</p>")}function t_alert(e){$("#bg_mask").fadeIn("fast"),$("#modal_close_btn").fadeIn("fast"),$("body").prepend("<div class='thicket-alert'>"+e+"</div>"),$(".thicket-alert").delay(100).fadeIn("fast")}function highlightSearch(e){$(".primary-content-box").html();$(".primary-content-box h3").wrapInTag({tag:"span class=search_highlight",words:[e]})}function onSignIn(e){$("#ga_login").delay(1e3).fadeOut();var t=e.getBasicProfile();$("#username").val(t.getEmail())}function blink(e){$(e).animate({opacity:0},200,"linear",function(){$(this).animate({opacity:1},200)})}function isValidEmailAddress(e){var t=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return t.test(e)}function onRegister(e){if(register){$("#ga_signup").hide();var t=e.getBasicProfile();$("#name_s").val(t.getName()),$("#username_s").val(t.getEmail())}}function appendDelete(){$(".rest_of_content").each(function(){var e=$(this).attr("id");$(this).prepend('<span class="delete_post_admin" id="'+e+'">Remove</span>')}),$(".delete_post_admin").on("click",function(){var e=$(this),t=$(this).attr("id");$.post(thicketURL+"/includes/engine/modules/delete_post.php",{post_id:t}).done(function(t){"false"!=t&&(t_alert("The post was successfully deleted."),e.parent().fadeOut("fast"))})})}document.addEventListener("touchstart",function(){},!0),logged_in=!1;var thicketURL=$("#thicket_site_identifier").val(),thicketHeight=window.innerHeight,thicketChromeHeight=138,thicketTime=(new Date).getTime();$(document).ready(function(){$.post(thicketURL+"/includes/engine/modules/session_validate.php",{token:"OtydHVLTLXq3FMCLFbEf"}).done(function(e){"false"!=e&&(logged_in=!0,user_id=e,$(".show-logged-in").show()),padlock(".create_video","Sorry, but you need to <a href='"+thicketURL+"/login'>login</a> or <a href='"+thicketURL+"/login#register'>register</a> on Thicket to publish your own video."),padlock(".content__comments__content","<a href='"+thicketURL+"/login'>Login</a> or <a href='"+thicketURL+"/login#register'>register</a> on Thicket to comment on student creations.")})});var td_name=$("#thicketdata-name").val(),td_username=$("#thicketdata-username").val(),td_uid=$("#thicketdata-uid").val();$(function(){var e=$(".primary-content-box#main li").toArray().sort(function(e,t){return parseInt($(t).children(".upvote").text(),10)-parseInt($(e).children(".upvote").text(),10)});$(".primary-content-box#main").html(e).show(),$(".upvote").on("click",function(){var e=$(this);if(logged_in&&!$(this).hasClass("voted")){var t=$(this).attr("id");$.post(thicketURL+"/includes/engine/modules/upvote.php",{token:"OtydHVLTLXq3FMCLFbEf",user_id:user_id,post_id:t}).done(function(t){"false"!=t?(e.addClass("voted"),"same"!=t&&e.text(t)):t_alert("Something went wrong.")})}else t_alert($(this).hasClass("voted")?"You already voted for this post":"You need to login to upvote a post")}),$(".content_trigger").on("click",function(){$(this).attr("href");$("#video-modal").fadeIn("medium"),$("#bg_mask").show(),$("#modal_close_btn").show();var e=$(this).parent().find(".url_id_holder").val();return $("#video-modal").html("<iframe width='560' height='315' src='https://www.youtube.com/embed/"+e+"?autoplay=true' frameborder='0' allowfullscreen></iframe>"),!1})}),function(e){e.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()}}(jQuery),$.fn.wrapInTag=function(e){var t=e.tag||"strong",a=e.words||[],i=RegExp(a.join("|"),"gi"),s="<"+t+">$&</"+t+">";return this.html(function(){return $(this).text().replace(i,s)})},$("#modal_close_btn, #bg_mask").on("click",function(){$("#video-modal").html(""),$("#video-modal").hide(),$(".thicket-alert").fadeOut("medium").remove(),$("#bg_mask").fadeOut("medium"),$("#modal_close_btn").hide()}),$(".explore-trigger").on("click",function(){$(this).hasClass("clicked")?($("#explore-popup").remove(),$(this).toggleClass("clicked")):($(".header__nav--left").append("<div id='explore-popup'><h2 class='explore-popup__header'>Resources</h2><p class='explore-popup__lead'>Explore Thicket resources to troubleshoot or improve your site</p><div class='explore-popup__subjects'><a href='http://github.com/jujubeweb/thicket' class='explore-popup__subjects__subject'>Github</a><a href='//thicket.readme.io/docs' class='explore-popup__subjects__subject'>Documentation</a><a href='//thicket.readme.io/discuss' class='explore-popup__subjects__subject'>Support</a></div>"),$(this).toggleClass("clicked"))}),$(".content__sidebar__close").on("click",function(){$(".content__sidebar").addClass("minimized"),$(".open-sidebar").fadeIn("medium")});var thicketSidebarDataHeight=thicketHeight-thicketChromeHeight;thicketHeight&&$(".content__sidebar__data").css("height",thicketSidebarDataHeight+"px"),$(".open-sidebar").text("Open chat"),$(".open-sidebar").on("click",function(){$(this).fadeOut("fast"),$(".content__sidebar").removeClass("minimized"),$(".content__sidebar__input").focus()});var first_message=!1;td_uid&&($(".content__sidebar__data").scrollTop($(".content__sidebar__data")[0].scrollHeight),setInterval(function(){$(".content__sidebar__data").scrollTop($(".content__sidebar__data")[0].scrollHeight),$.get(thicketURL+"/includes/engine/modules/chat_get.php",{time:thicketTime},function(e){$(".content__sidebar__data").html(e)}),$(".content__sidebar__data").css("opacity","1")},500)),$(".content__sidebar__input").keypress(function(e){var t=$(this);if(13==e.which){var a=t.val().replace(/(<([^>]+)>)/gi,"");if(""==$.trim(a)||-1!==t.val().indexOf("<!--"))return t_alert("Invalid message text. Please try again.","black"),t.val(""),!1;var i=td_name.substring(0,td_name.indexOf(" ")),s=(new Date).getTime();return $.post(thicketURL+"/includes/engine/modules/chat_post.php",{sender:i,user_id:td_uid,content:a,location:"1",time:s}).done(function(e){"success"==e||t_alert("The message could not be sent due to a server error.")}),first_message&&(i=""),first_message=!0,t.val(""),!1}});var register=!1;$(".login-intent-switcher").on("click",function(){register=!0,$(".content__main--right .content__main__lead").html("<form method='post' action='"+thicketURL+"/includes/engine/modules/form_process.php' class='login-form signup-form' id='signup-form' novalidate><p style='color:red;font-weight:400;font-size:1em' id='form_error' class='hidden'></p> <p class='content__main__paragraph'> <label for='name_s' class='login-form__label'>Name</label> <input id='name_s' name='name_s' class='login-form__input' style='width:220px' required> </p> <p class='content__main__paragraph'> <label for='username_s' class='login-form__label'>Email address</label> <input id='username_s' name='username_s' class='login-form__input' type='email' style='width:220px' required> </p> <p class='content__main__paragraph'> <label for='password_s' class='login-form__label'>Password</label> <input id='password_s' name='password_s' style='width:220px' class='login-form__input' type='password' required> <label for='password_cs' class='login-form__label'>Confirm password</label> <input id='password_cs' name='password_cs' style='width:220px' class='login-form__input' type='password' required> <input type='hidden' name='csrf_token' value=''> </p> <input class='login-form__submit' id='signup_submit' type='submit' value='Register'></form><p class='hidden' id='submit_result'></p>"),$("#name_s").focus(),$("#ga_signup_holder").show(),$(".content__main--left").css("opacity",".3"),$(".content__main--left .login-form__submit").css("pointerEvents","none"),$(".content__main--left").click(function(){$(this).css("opacity","1"),$(this).css("pointerEvents","all"),$(".content__main--left .login-form__submit").css("pointerEvents","all")}),$("#signup-form").on("submit",function(){var e=$("#name_s").val(),t=$("#username_s").val(),a=$("#password_s").val(),i=$("#password_cs").val();if(e&&t&&a&&i){var s=/^[a-zA-Z ]+$/,n=/^(?=.*\d)(?=.*[a-zA-Z]).{6,16}$/;a!=i?($(document).scrollTop(0),$("#form_error").fadeIn().text("The passwords do not match."),blink("#form_error")):isValidEmailAddress(t)?s.test(e)?n.test(a)?($("#form_error").fadeOut(),$.post(thicketURL+"/includes/engine/modules/form_process_register.php",{name:e,username:t,password:a}).done(function(t){"success"==t?($("#signup-form, #ga_signup_holder").fadeOut("fast"),$("#submit_result").fadeIn().html("Welcome to Thicket, <b class=regular>"+e+"</b>! You can now login to your account.")):$("#submit_result").fadeIn().text("user exists"==t?"There is a user with that email already.":"The form could not be submitted. Please try again.")})):($("#form_error").fadeIn().text("Your password needs to be between 6 and 16 characters and have at least one number."),blink("#form_error")):($("#form_error").fadeIn().text("Your name can only have letters."),blink("#form_error")):($("#form_error").fadeIn().text("Please enter a valid email address."),blink("#form_error"))}else $(document).scrollTop(0),$("#form_error").fadeIn().text("All fields are required to register.");return!1})}),$(".admin_view_switcher").on("click",function(){var e=$(this).attr("id");$(this).hasClass("active")||($(".active").removeClass("active"),$(this).addClass("active")),$(".admin-screen").hide(),$("#"+e+"_screen").show()});